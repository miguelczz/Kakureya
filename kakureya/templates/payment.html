{% extends 'base.html' %}
{% block content %}
<main class="container py-5">
    <h1 class="text-center mb-4">Procesamiento de Pago</h1>

    <div class="row">
        <div class="col-md-7">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Pago con Wompi</h5>
                </div>
                <div class="card-body">
                    <p class="mb-4">Total a pagar: <strong>${{ total|floatformat:0 }}</strong></p>

                    <!-- Widget de pago de Wompi -->
                    <form>
                        <script src="https://checkout.wompi.co/widget.js" data-render="button"
                            data-public-key="{{ wompi_data.public_key }}" data-currency="COP"
                            data-amount-in-cents="{{ wompi_data.amount_in_cents }}"
                            data-reference="{{ wompi_data.reference }}"
                            data-signature:integrity="{{ wompi_data.integrity_hash }}"></script>
                    </form>

                    <div class="alert alert-info mt-4">
                        <p class="mb-0">Al hacer clic en "Pagar con Wompi", podrás completar tu compra de forma segura
                            sin salir de esta página.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-5">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Detalles del pedido</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for item in sale_items %}
                        <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <div>
                                <span>{{ item.product.name }}</span>
                                <small class="d-block text-muted">Cantidad: {{ item.quantity }}</small>
                            </div>
                            <span>${{ item.price_at_sale|floatformat:0 }} × {{ item.quantity }}</span>
                        </li>
                        {% endfor %}
                    </ul>

                    <hr>

                    <div class="d-flex justify-content-between">
                        <span>Subtotal</span>
                        <span>${{ subtotal|floatformat:0 }}</span>
                    </div>

                    <div class="d-flex justify-content-between">
                        <span>Envío</span>
                        <span>${{ shipping_cost|floatformat:0 }}</span>
                    </div>

                    <hr>

                    <div class="d-flex justify-content-between fw-bold">
                        <span>Total</span>
                        <span>${{ total|floatformat:0 }}</span>
                    </div>

                    <div class="mt-3">
                        <p><strong>Dirección de entrega:</strong><br>
                            {{ sale.address }}</p>

                        {% if sale.notes %}
                        <p><strong>Notas:</strong><br>
                            {{ sale.notes }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}