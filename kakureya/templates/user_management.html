{% extends 'base.html' %}
{% block content %}

<div class="container py-4">
  <h2 class="mb-4">Gestión de usuarios</h2>

  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle" style="table-layout: fixed;">
      <colgroup>
        <col style="width: 20%;">
        <col style="width: 20%;">
        <col style="width: 30%;">
        <col style="width: 15%;">
      </colgroup>
      <thead>
        <tr>
          <th class="text-center">Usuario</th>
          <th class="text-center">Grupo actual</th>
          <th class="text-center">Asignar grupo</th>
          <th class="text-center">Eliminar</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td class="text-center">
            {{ user.first_name }} {{ user.last_name }}<br>
            <small class="text-muted">{{ user.email }}</small>
          </td>

          <td class="text-center">
            {{ user.groups.first.name|default:"Sin grupo" }}
          </td>

          <td class="text-center">
            <form method="POST" class="d-flex justify-content-center gap-2 mb-0">
              {% csrf_token %}
              <input type="hidden" name="user_id" value="{{ user.id }}">
              <select name="group_id" class="form-select form-select-sm w-auto">
                {% for grupo in grupos %}
                  <option value="{{ grupo.id }}">{{ grupo.name }}</option>
                {% endfor %}
              </select>
              <button type="submit" name="assign_group" class="btn btn-sm btn-dark">
                Asignar
              </button>
            </form>
          </td>

          <td class="text-center">
            <form method="POST"
                  onsubmit="return confirm('¿Seguro que deseas eliminar este usuario?')"
                  class="mb-0">
              {% csrf_token %}
              <input type="hidden" name="user_id" value="{{ user.id }}">
              <button type="submit" name="delete_user" class="btn btn-sm btn-danger">
                Eliminar
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
